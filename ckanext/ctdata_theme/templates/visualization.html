{% extends "page.html" %}

{% block title %}CTData Visualization - {{ dataset.title }} {% endblock %}
{% block page_name %}{{ dataset.title }}{% endblock %}
{% block page_description %}Profile info{% endblock %}


{% block main_content %}
<div class="ctdata-wrapper">
<div class="headline_indicators">
  {% if headline_indicators %}
    <select class="custom bbtn" onchange="window.location.href=this.value">
      <option selected="true" value="/visualization/{{dataset.name}}">
        <span >-- Select Headline Indicator --</span>
        <span class="caretbox"><span class="caret"></span></span>
      </option>
      {% for indicator in headline_indicators %}
        <option value="/visualization/{{dataset.name}}?ind={{indicator.id}}" class="head_ind_link" id="{{indicator.id}}"> {{indicator.name}} </option>
      {% endfor %}
    </select>

    {% if c.userobj.sysadmin %}
      <a href="javascript:void(0);" id="edit_headline_indicators" class="btn"> Edit </a>
    {% endif %}
  {% endif %}
</div>

<form>
    <input type="hidden" id="dataset_id" value="{{ dataset.name }}">
    <input type="hidden" id="dataset_title" value="{{ dataset.title }}">
</form>

<section class="visualisation">

<div class="refine_wrap">
<h2>Refine This Indicator <img src="/common/images/arrowimg.png" alt="" /></h2>
<ul>
{% for dimension in dimensions %}
{% if dimension.possible_values %}

<li class="filter">
  <a href="#collapse{{dimension.name|replace(" ", "")|replace("/", "\/")}}" data-toggle="collapse" class="togglebtn dimension">{{dimension.name}}</a>
  <div id="collapse{{dimension.name|replace(" ","")}}" class="panel-collapse collapse">
  <span>
      {% if dimension.name == 'Town' %}
        <a href="javascript:void(0);" class="select-all">Select All</a>
        <a href="javascript:void(0);" class="deselect-all">Deselect All</a>
      {% endif %}
  </span>
  <ul>
  {% for value in dimension.possible_values %}
    {% if value|length > 0 %}
    <li id = "{{value}}">
        <input type="checkbox" id="{{value}}Check" value="{{value}}" name="{{dimension.name}}" class="{{dimension.name|replace(" ","")|replace("/","\/")}}">
        <label for="{{value}}Check" class="checkLabel">{{value}}</label>
    </li>
    {% endif %}
  {% endfor %}
  </ul>
  </div>
</li>
{% endif %}
{% endfor %}
<!--
<li>
<div class="refine_options">
<div class="input_row"><input type="checkbox"> <label>Quartile 1</label></div>
<div class="input_row"><input type="checkbox"> <label>Quartile 2</label></div>
<div class="input_row"><input type="checkbox"> <label>Quartile 3</label></div>
<div class="input_row"><input type="checkbox"> <label>Quartile 4</label></div>
</div>
</li>
-->
</ul>

</br>
{% if c.userobj.sysadmin %}
<a href="javascript:void(0);" id="save_headline_indicator" class="btn"> Save Filters </a>
{% endif %}
</div>


<div class="visual_right">
<div class="option_row">
<div class="customselectinner">
<select class="custom">
<option selected>Kindergarten Inventory Quartiles</option>
<option>Kindergarten Inventory Quartiles</option>
<option>Kindergarten Inventory Quartiles</option>
</select>
</div>

<div class="display_options">
<label>Display As</label>
<ul>
<li><a href="javascript:void(0)" onclick="set_display_type('table')"><img id="table_icon" src="/common/images/displayopt1-inv.png" alt="" /></a></li>
<li><a href="javascript:void(0)" onclick="set_display_type('column')"><img id="bar_icon" src="/common/images/displayopt2.png" alt="" /></a></li>
<li><a href="javascript:void(0)" onclick="set_display_type('line')"><img id="line_icon" src="/common/images/displayopt3.png" alt="" /></a></li>
<li><a href="javascript:void(0)" onclick="set_display_type('map')"><img id="map_icon" src="/common/images/displayopt4.png" alt="" /></a></li>
<li style="padding-top: 3px;"><a href="/dataset/{{dataset.name}}">Raw Data</a>
</ul>
</div>


<div class="operations">
<label>Operations</label>
<ul>
<li><a href="javascript:void(0)" onclick="print_chart()"><img src="/common/images/operation1.png" alt="" /></a></li>
<li><a href="javascript:void(0)" onclick="save_chart_image()"><img src="/common/images/operation2.png" alt="" /></a></li>
<li><a href="javascript:void(0)" onclick="save_chart_pdf()"><img src="/common/images/operation3.png" alt="" /></a></li>
</ul>
</div>

</div>
<div class="spinner"> <img src="/common/images/loading.gif"/> </div>
<div class="results_table">
    <div id="container" style="min-width: 310px; min-height: 400px; margin: 0 auto"></div>

    <div id="metadata" >
      <a class="togglebtn metadata_container">About this dataset</a>
      <div id="collapseMetadata">
        <ul>
        {% for property in metadata %}
          <li>
            <a class="togglebtn", >{{property['key']}}</a>
            <div class="dataValue" id={{property['key']}}>
                {{property['value']}}
            </div>
          </li>
        {% endfor %}

        </ul>
      </div>
      <div class="full_metadata_link">
        <a href="/dataset/{{dataset.name}}#additional_info" >View Full Metadata</a>
      <div>
    </div>


</div>

</div>

</div>

<div id="create_indicator_popup" class="modal fade" style="display: none">
    <div class="modal-dialog modal-lg">
        <div class="modal-header">
            Create Headline Indicator
        </div>
        <div class="modal-content">
            <div class="modal-body disable-scroll">
                <div>
                  <form class="form-horizontal">
                    <div class="control-group">
                      <label class="control-label"> Indicator name </label>
                      <div class="controls">
                        <input type="text" name="indicator_name" id="indicator_name"> </input>
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label"> Selected Fiters </label>
                      <div class="controls"> <div id="selected_filters" ></div> </div>
                    </div>
                  </form>
                </div>
            </div>
            <div class="modal-footer">
                <div style="float: right">
                    <button id="create_headline_indicator" class="btn btn-info">Save</button>
                    <button class="btn close_popup">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="edit_indicators_popup" class="modal fade" style="display: none">
    <div class="modal-dialog modal-lg">
        <div class="modal-header">
            Update Headline Indicators
        </div>
        <div class="modal-content">
            <div class="modal-body disable-scroll">
                <div id="error" class="error" style="opacity: 0"> </div>
                <div>
                  <form class="form-horizontal">
                    {% for indicator in headline_indicators %}
                      <div class="control-group">
                        <label class="control-label"> Indicator {{indicator.id}} </label>
                        <div class="controls">
                          <input type="text" name="indicator_name" id="{{indicator.id}}" value="{{indicator.name}}" class="edit_name"></input>
                          <a href="javascript:void(0);" class="remove_indicator" id="{{indicator.id}}"> <i class='fa fa-times text-error'></i> </a>
                        </div>
                      </div>
                    {% endfor %}
                  </form>
                </div>
            </div>
            <div class="modal-footer">
                <div style="float: right">
                    <button id="update_headline_indicators" class="btn btn-info">Update</button>
                    <button class="btn close_popup">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="/common/css/visualization.css">
<link rel="stylesheet" type="text/css" href="/common/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css" href="/common/css/tableTools.css">
{% resource 'ctdata_theme/highcharts.js' %}
{% resource 'ctdata_theme/Highmaps-1.0.4/js/modules/map.js' %}
{% resource 'ctdata_theme/Highmaps-1.0.4/js/modules/data.js' %}
{% resource 'ctdata_theme/Highmaps-1.0.4/js/modules/exporting.js' %}
{% resource 'ctdata_theme/visualization.js' %}
{% resource 'ctdata_theme/jquery.dataTables.js' %}
{% resource 'ctdata_theme/map_chart.js' %}
<script>
var defaults = [];
{% if default_filters %}
defaults = {{default_filters | safe}}
{% endif %}
var disabled = [];
{% if disabled %}
disabled = {{disabled | safe}}
{% endif %}
</script>
{% endblock %}
